name: release-production
on:
  push:
    tags:
      - "v*.*.*"
jobs:
  create-release-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    timeout-minutes: 30
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Set up Git
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
      - name: Create a new branch from tag
        run: |
          TAG_NAME=${GITHUB_REF#refs/tags/}
          echo "tag_name=$TAG_NAME" >> $GITHUB_ENV
          BRANCH_NAME=release/${TAG_NAME}
          echo "branch_name=$BRANCH_NAME" >> $GITHUB_ENV
          git fetch --tags
          git checkout -b $BRANCH_NAME $TAG_NAME
          git push origin $BRANCH_NAME
      - name: Create Pull Request
        run: |
          gh pr create \
            --base production --head ${{ env.branch_name }} \
            --title "Release ${{ env.tag_name }}" \
            --body "This pull request is automatically created for the release of tag ${{ env.tag_name }}."
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT }}
